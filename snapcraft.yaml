name: spread
summary: Convenient full-system test (task) distribution
description: |
    Spread is a plesant way distribute full-system integration tests and
    similar tasks. A few simple and concrete concepts that are fun to play
    with and fix the exact piece missing in the puzzle. It's not Jenkins,
    it's not Travis, it's not a library, not a language, and it's not even
    specific to testing. It's a simple way to express what to run and
    where, what to do before and after it runs, and how to duplicate jobs
    with minor variations without copy & paste.
adopt-info: spread
confinement: strict
grade: stable
base: core18

plugs:
    dot-spread:
        interface: personal-files
        write:
        - $HOME/.spread
    dot-config-gcloud:
        interface: personal-files
        read:
        - $HOME/.config/gcloud

apps:
    spread:
        command: bin/spread
        plugs: [home, network, network-bind, dot-spread, dot-config-gcloud]
        adapter: none

parts:
    spread:
        plugin: go
        build-packages:
            - gcc
            - git               # needed to get deps
        source:
            .
        go-importpath: github.com/snapcore/spread
        override-pull: |
            # do the usual pull stuff
            snapcraftctl pull
            # set the version from today's date
            snapcraftctl set-version "$(date --rfc-3339=date)"
